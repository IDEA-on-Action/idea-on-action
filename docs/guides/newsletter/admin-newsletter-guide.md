# Newsletter Admin 관리 가이드

> 뉴스레터 구독자 관리 시스템 사용법

**버전**: 2.3.4
**마지막 업데이트**: 2025-11-22
**대상**: 시스템 관리자 (super_admin)
**페이지 경로**: `/admin/newsletter`

---

## 목차

1. [개요](#개요)
2. [권한 요구사항](#권한-요구사항)
3. [주요 기능](#주요-기능)
4. [통계 대시보드](#통계-대시보드)
5. [구독자 목록 관리](#구독자-목록-관리)
6. [검색 및 필터링](#검색-및-필터링)
7. [날짜 범위 필터 (DateRangePicker)](#날짜-범위-필터-daterangepicker)
8. [CSV 내보내기](#csv-내보내기)
9. [구독자 상태 관리](#구독자-상태-관리)
10. [구독자 삭제 (GDPR)](#구독자-삭제-gdpr)
11. [문제 해결](#문제-해결)
12. [관련 문서](#관련-문서)

---

## 개요

Newsletter Admin 페이지는 뉴스레터 구독자를 관리하기 위한 CMS 관리자 전용 페이지입니다.

### 핵심 기능
- 구독자 목록 조회 및 검색
- 상태별 필터링 (pending/confirmed/unsubscribed)
- 날짜 범위 필터링 (DateRangePicker)
- CSV 파일 내보내기
- 구독자 상태 변경
- GDPR 준수 삭제

### 접근 방법
1. **직접 URL**: `https://www.ideaonaction.ai/admin/newsletter`
2. **관리자 메뉴**: Admin Dashboard > System > Newsletter

---

## 권한 요구사항

### 필수 권한
- `super_admin` 역할 필요
- 관리자 로그인 필수

### 접근 제한
- 비로그인 시: `/login` 페이지로 리다이렉트
- 권한 부족 시: 접근 거부 메시지 표시
- RLS (Row Level Security) 정책으로 데이터 보호

### 권한 확인 방법
1. 관리자 계정으로 로그인
2. `/admin/dashboard` 접근 가능 여부 확인
3. Newsletter 메뉴 표시 여부 확인

---

## 주요 기능

### 페이지 구성
1. **헤더 영역**
   - 페이지 제목: "Newsletter Subscribers"
   - CSV 내보내기 버튼

2. **통계 대시보드** (4개 카드)
   - 전체 구독자 수
   - 확인 완료 (confirmed)
   - 확인 대기 (pending)
   - 구독 취소 (unsubscribed)

3. **필터 영역**
   - 이메일 검색창
   - 상태 필터 드롭다운
   - 날짜 범위 선택기 (DateRangePicker)
   - 필터 초기화 버튼

4. **구독자 목록 테이블**
   - 이메일, 상태, 구독일, 구독 경로, 액션 컬럼
   - 페이지네이션 (50개씩)

---

## 통계 대시보드

페이지 상단에 4개의 통계 카드가 표시됩니다.

### 전체 구독자 카드
- **아이콘**: Users
- **표시 내용**: 모든 상태의 구독자 총합
- **부가 정보**: 일일 신규 구독자 수 (예: "+5 오늘")

### 확인 완료 카드
- **아이콘**: CheckCircle (초록색)
- **표시 내용**: confirmed 상태 구독자 수
- **부가 정보**: 전체 대비 비율 (예: "85.3%")

### 확인 대기 카드
- **아이콘**: Clock (노란색)
- **표시 내용**: pending 상태 구독자 수
- **부가 정보**: "이메일 확인 필요" 메시지

### 구독 취소 카드
- **아이콘**: XCircle (회색)
- **표시 내용**: unsubscribed 상태 구독자 수
- **부가 정보**: 이탈률 (예: "2.5%")

### 이탈률 해석 기준
- **건강**: 5% 이하
- **주의**: 5~10% (콘텐츠 품질 점검 필요)
- **위험**: 10% 이상 (긴급 개선 필요)

---

## 구독자 목록 관리

### 테이블 컬럼

| 컬럼 | 설명 |
|------|------|
| 이메일 | 구독자 이메일 주소 |
| 상태 | Badge 형식 (확인 대기/확인 완료/구독 취소) |
| 구독일 | 한국어 날짜 포맷 (예: 2025년 11월 22일) |
| 구독 경로 | Footer, Popup, Website, API, 수동 추가 |
| 액션 | 드롭다운 메뉴 (상태 변경, 삭제) |

### 페이지네이션
- **표시 개수**: 50개씩 (고정)
- **네비게이션**: 이전/다음 버튼
- **표시 형식**: "페이지 1 / 5 (전체 234명)"
- **자동 스크롤**: 페이지 이동 시 상단으로 스크롤

---

## 검색 및 필터링

### 이메일 검색
- **위치**: 필터 영역 좌측
- **동작**: 실시간 검색 (입력 즉시 반영)
- **대소문자**: 구분 없음
- **부분 일치**: 지원

**검색 예시**:
```
검색어: "test"
결과:
- test@example.com
- testuser@gmail.com
- user@test.com
```

### 상태 필터
- **위치**: 검색창 우측
- **기본값**: "전체 상태"
- **옵션**:
  - 전체 상태 (all)
  - 확인 대기 (pending)
  - 확인 완료 (confirmed)
  - 구독 취소 (unsubscribed)

### 필터 조합
모든 필터는 AND 조건으로 적용됩니다.

**예시**: 확인 대기 중인 Gmail 사용자
```
검색어: "@gmail.com"
상태: 확인 대기
결과: pending 상태 + Gmail 도메인만 표시
```

### 필터 초기화
- **조건**: 검색어, 상태 필터, 날짜 범위 중 하나라도 적용된 경우
- **버튼**: "필터 초기화" (XCircle 아이콘)
- **동작**: 모든 필터 해제, 첫 페이지로 이동

---

## 날짜 범위 필터 (DateRangePicker)

v2.3.4에서 추가된 날짜 범위 필터 기능입니다.

### 위치
검색창 우측, 상태 필터 옆에 위치합니다.

### 기본 사용법

**방법 1: Preset 버튼 (빠른 선택)**
1. "날짜 범위 선택" 버튼 클릭
2. Popover에서 Preset 버튼 선택:
   - 지난 7일
   - 지난 30일
   - 지난 90일
   - 전체 (필터 해제)

**방법 2: Calendar 직접 선택**
1. "날짜 범위 선택" 버튼 클릭
2. Calendar에서 시작일 클릭
3. Calendar에서 종료일 클릭
4. 선택 완료 (자동 적용)

### 날짜 필터 특징
- **2개월 달력**: 좌우로 두 달이 표시됨
- **선택 상태 표시**: 선택된 날짜 범위가 하이라이트
- **반응형**: 모바일에서도 사용 가능
- **다크 모드**: 테마에 맞게 자동 변경

### 사용 시나리오

**시나리오 1: 월별 보고서**
```
목적: 2025년 11월 구독자 현황
1. 날짜 범위: 2025-11-01 ~ 2025-11-30
2. CSV 내보내기
3. Excel에서 분석
```

**시나리오 2: 최근 pending 확인**
```
목적: 지난 7일간 pending 상태 확인
1. Preset: "지난 7일" 클릭
2. 상태: "확인 대기" 선택
3. 목록 확인 후 수동 승인 또는 재발송
```

**시나리오 3: 캠페인 효과 측정**
```
목적: 특정 캠페인 기간 구독자 분석
1. 날짜 범위: 캠페인 시작일 ~ 종료일
2. 통계 대시보드 확인
3. CSV 내보내기 후 구독 경로 분석
```

### 날짜 필터 초기화
- **"전체" Preset 버튼** 클릭
- 또는 **"필터 초기화"** 버튼 클릭

---

## CSV 내보내기

### 기본 사용법
1. 필요한 필터 적용 (선택 사항)
2. 우측 상단 "CSV 내보내기" 버튼 클릭
3. 파일 자동 다운로드
4. Toast 알림: "N명의 구독자 데이터를 내보냈습니다."

### 필터 적용
현재 적용된 모든 필터가 CSV에 반영됩니다:
- 이메일 검색어
- 상태 필터
- 날짜 범위 필터

### 파일 정보
- **파일명**: `newsletter-subscribers-YYYY-MM-DD.csv`
- **인코딩**: UTF-8 with BOM (Excel 한글 지원)
- **구분자**: 쉼표 (`,`)

### CSV 컬럼 구조

| 컬럼명 | 설명 |
|--------|------|
| Email | 구독자 이메일 주소 |
| Status | pending/confirmed/unsubscribed |
| Subscribed At | 구독 신청일 (ISO 8601) |
| Confirmed At | 이메일 확인일 (없으면 빈 값) |
| Unsubscribed At | 구독 취소일 (없으면 빈 값) |
| Source | 구독 경로 (footer/popup/website/api/manual) |

### 날짜 필터 적용 예시

```
날짜 범위: 2025-11-01 ~ 2025-11-30
상태: confirmed

CSV 내보내기 결과:
- 11월 구독 + confirmed 상태인 구독자만 포함
```

---

## 구독자 상태 관리

### 상태 변경 방법
1. 구독자 목록에서 대상 구독자 찾기
2. 액션 컬럼의 점 세 개 (MoreVertical) 아이콘 클릭
3. 드롭다운 메뉴에서 원하는 액션 선택

### 상태별 가능한 액션

**pending -> confirmed (확인 완료로 변경)**
- 사용 시나리오: 전화/채팅으로 본인 확인 완료
- 결과: confirmed_at 타임스탬프 업데이트

**confirmed -> unsubscribed (구독 취소로 변경)**
- 사용 시나리오: 사용자 구독 취소 요청
- 결과: unsubscribed_at 타임스탬프 업데이트

**unsubscribed -> confirmed (확인 완료로 복구)**
- 사용 시나리오: 사용자 재구독 요청
- 결과: confirmed_at 타임스탬프 업데이트

### 상태 변경 완료 시
- Toast 알림: "구독자 상태가 'OOO'(으)로 변경되었습니다."
- 통계 대시보드 자동 업데이트
- 목록 실시간 반영

---

## 구독자 삭제 (GDPR)

### GDPR Article 17 (잊혀질 권리)
사용자가 데이터 삭제를 요청한 경우에만 사용하세요.

### 삭제 절차
1. 액션 컬럼 드롭다운 메뉴 클릭
2. "삭제 (GDPR)" 옵션 선택
3. 확인 대화상자에서 내용 확인
4. "삭제" 버튼 클릭

### 삭제 전 확인 사항
- [ ] 사용자가 실제로 삭제를 요청했는가?
- [ ] 법적 보관 의무가 없는가? (세법: 5년, 상법: 10년)
- [ ] 삭제 요청을 문서화했는가?
- [ ] 삭제 대신 unsubscribed 상태로 변경하는 것이 나은 선택이 아닌가?

### 주의사항
- **영구 삭제**: 복구 불가능
- **즉시 반영**: 목록과 통계에서 즉시 제거

---

## 문제 해결

### 권한 오류
**증상**: "권한이 없습니다" 메시지

**해결 방법**:
1. 로그아웃 후 재로그인
2. super_admin 권한 확인
3. Supabase Dashboard에서 user_roles 테이블 확인

### 데이터 로딩 실패
**증상**: "구독자 목록을 불러오는데 실패했습니다" 메시지

**해결 방법**:
1. 네트워크 연결 확인
2. 페이지 새로고침
3. Supabase 서비스 상태 확인

### CSV 다운로드 실패
**증상**: 버튼 클릭 후 아무 반응 없음

**해결 방법**:
1. 구독자가 0명인지 확인 (버튼 비활성화 조건)
2. 브라우저 팝업 차단 해제
3. 개발자 도구에서 콘솔 오류 확인

### 날짜 필터 미작동
**증상**: 날짜 선택 후 목록 변화 없음

**해결 방법**:
1. 시작일이 종료일보다 이전인지 확인
2. 선택한 기간에 구독자가 있는지 확인
3. 다른 필터와 조합 시 결과가 없을 수 있음

### pending 상태 오래 유지
**증상**: 7일 이상 pending 상태 유지

**해결 방법**:
1. 이메일 발송 로그 확인
2. 인증 이메일 재발송 (별도 시스템)
3. 본인 확인 후 수동 승인 (상태 변경)

### 통계 업데이트 지연
**증상**: 상태 변경 후 통계가 바로 안 바뀜

**해결 방법**:
1. React Query 캐시: 최대 60초 대기
2. 페이지 새로고침
3. 브라우저 캐시 삭제

---

## 관련 문서

### 기술 문서
- [Newsletter CSV Export 구현 요약](./csv-export-implementation-summary.md)
- [날짜 필터 통합 가이드](./date-filter-integration.md)
- [빌드 검증 보고서 v2.3.4](./build-verification-report-v2.3.4.md)

### 프로젝트 문서
- [전체 작업 요약](./WORK_SUMMARY.md)
- [완료 보고서 v2.3.4](./newsletter-date-filter-completion-report.md)

### CMS 가이드
- [CMS Admin Newsletter 가이드](../cms/admin-newsletter-guide.md) - 상세 버전

### 관련 소스 코드
- 페이지: `src/pages/admin/AdminNewsletter.tsx`
- 훅: `src/hooks/useNewsletterAdmin.ts`
- 타입: `src/types/newsletter.types.ts`
- DateRangePicker: `src/components/ui/date-range-picker.tsx`

---

**문의**: 가이드 관련 질문은 관리자에게 문의하세요.
**버전**: v2.3.4 (2025-11-22)
